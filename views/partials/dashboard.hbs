<div class="dashboard">
    <div class="profile-card">
        <div class="profile-card-info d-flex justify-content-center flex-column align-items-center">
            <div class="profile-card-avatar">
                <img src="{{data.avatar_src}}" alt="Rick Grimes">
            </div>
            <span class="profile-card-name">{{data.firstname}} {{data.surname}}</span>
            <a href="#" class="profile-card-username">@{{data.username}}</a>
        </div>
        <ul class="profile-stats list-group">
            <li class="list-group-item d-flex justify-content-between align-items-center borderless">
                Записей
                <span class="badge badge-primary badge-pill">{{stats.posts}}</span>
            </li>
            <li class="list-group-item d-flex justify-content-between align-items-center borderless">
                <a href="/{{data.username}}/subscribtions/">Подписок</a>
                <span class="badge badge-primary badge-pill">{{stats.subscribtion}}</span>
            </li>
            <li class="list-group-item d-flex justify-content-between align-items-center borderless" id="subscribers">
                <a href="/{{data.username}}/subscribers/">Подписчиков</a>
                <span class="badge badge-primary badge-pill">{{stats.subscribes}}</span>
            </li>
            <li class="list-group-item d-flex justify-content-between align-items-center borderless">
                <a href="/{{data.username}}/liked_posts/">Понравилось постов</a>
                <span class="badge badge-primary badge-pill">{{stats.likes}}</span>
            </li>
        </ul>
        
    </div>
    {{#if current_profile}}
        <button class="btn btn-success w-100">Изменить профиль</button>
        {{else}}
        {{#if subscribe}}
            <a class="btn btn-secondary w-100 font-weight-bold text-light" id="subscribe-btn" data-action="unsubscribe">Отписаться</a>
            {{else}}
            <a class="btn btn-primary w-100 font-weight-bold text-light" id="subscribe-btn" data-action="subscribe">Подписаться</a>
        {{/if}}
    {{/if}}
</div>
<script src="js/ajax.js"></script>
<script>
    $('#subscribe-btn').on('click', function(e){
        e.preventDefault();
        AJAX('/subscribe', 'POST', {
            'action':$(this).data('action'), 
            'user_subscribe':'{{data.id}}'
        }, function(res){

                if(res.unsubscribe == true){
                    $('#subscribe-btn').removeClass('btn-secondary').addClass('btn-primary').data('action', 'subscribe').text('Подписаться');
                    $('#subscribers > span').text(parseInt(($('#subscribers > span').text()))-1);
                }
                if(res.subscribe == true){
                    $('#subscribe-btn').removeClass('btn-primary').addClass('btn-secondary').data('action', 'unsubscribe').text('Отписаться');
                    $('#subscribers > span').text(parseInt(($('#subscribers > span').text()))+1);
                }
            
        })
    })
</script>